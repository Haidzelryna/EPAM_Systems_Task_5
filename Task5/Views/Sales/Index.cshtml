
@using DevExtreme.AspNet.Mvc

@model IEnumerable<BLL.Sale>

@{
    ViewBag.Title = "Sales";
}

<h2>Sales List</h2>

<script src="https://unpkg.com/devextreme-aspnet-data/js/dx.aspnet.data.js"></script>

@(Html.DevExtreme().DataGrid<BLL.Sale>
    ()
    .ID("gridContainerSales")

    .DataSource(d => d.Mvc().Controller("SalesMVC").Key("Id")
        .LoadAction("Get")
        .InsertAction("Post")
        .UpdateAction("Put")
        .DeleteAction("Delete"))

    .RemoteOperations(true)

    .ShowBorders(true)

    .Selection(s => s.Mode(SelectionMode.Single))

    .Editing(e => e
    .Mode(GridEditMode.Batch)
    .AllowAdding(true)
    .AllowDeleting(true)
    .AllowUpdating(true))

    .SearchPanel(searchPanel => searchPanel
    .Visible(true)
    .Width(240)
    .Placeholder("Search..."))

    .Paging(p => p.PageSize(10))

    .Pager(p => p
    .ShowPageSizeSelector(true)
    .AllowedPageSizes(new[] { 10, 25, 50, 100 }))

    .HeaderFilter(headerFilter => headerFilter.Visible(true))

    .FilterPanel(filterPanel => filterPanel.Visible(true))

    .FilterRow(filterRow => filterRow
    .Visible(true)
    .ApplyFilter(GridApplyFilterMode.Auto))

    .AllowColumnReordering(true)
    .AllowColumnResizing(true)
    .ColumnAutoWidth(true)
    .ShowBorders(true)
    .ColumnChooser(c => c.Enabled(true))
    .ColumnFixing(c => c.Enabled(true))

    .Columns(columns =>
    {
        columns.Add()
            .DataField("Date")
            .DataType(GridColumnDataType.Date)
            .Format(Format.ShortDate);
        columns.AddFor(m => m.ClientName);
        columns.AddFor(m => m.ProductName);
        columns.AddFor(m => m.Sum);
        columns.Add()
            .DataField("Client.Id")
            .Caption("Client")
            .Width(125)
            .Lookup(lookup => lookup
            .DataSource(d => d.Mvc().Controller("ClientsMVC").Key("Id").LoadAction("Get"))
            .DisplayExpr("Name")
            .ValueExpr("Id"));
        columns.Add()
            .DataField("Product.Id")
            .Caption("Product")
            .Width(125)
            .Lookup(lookup => lookup
            .DataSource(d => d.Mvc().Controller("ProductsMVC").Key("Id").LoadAction("Get"))
            .DisplayExpr("Name")
            .ValueExpr("Id"));
        columns.Add()
            .DataField("Manager.Id")
            .Caption("Manager")
            .Width(125)
            .Lookup(lookup => lookup
            .DataSource(d => d.Mvc().Controller("ManagersMVC").Key("Id").LoadAction("Get"))
            .DisplayExpr("Name")
            .ValueExpr("Id"));
    })
)

@(Html.DevExtreme().Button()
    .Text("Refresh Grid")
    .OnClick("reloadData")
)

<script type="text/javascript">
    function reloadData() {
        $("#gridContainerSales").dxDataGrid("getDataSource").reload();
    }
</script>




